<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFB Rankings - {{ year }} Week {{ week }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            padding-top: 20px;
            background-color: #f8f9fa;
        }
        .header-bar {
            background-color: #e9ecef;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 0.3rem;
        }
        .table-container {
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 0.3rem;
            overflow: hidden;
        }
        .table {
            margin-bottom: 0;
        }
        th {
            background-color: #0d6efd;
            color: white;
        }
        tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.1);
        }
        .btn-back {
            margin-bottom: 20px;
        }
        .top-25 {
            background-color: #d1e7dd;
        }
        .top-25 td {
            font-weight: 500;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .tooltip-info {
            cursor: help;
        }
        .badge-power4 {
            background-color: #0d6efd;
            color: white;
        }
        .badge-group5 {
            background-color: #6c757d;
            color: white;
        }
        .badge-fcs {
            background-color: #6c757d;
            color: white;
            opacity: 0.8;
        }
        .scroll-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        .scroll-btn:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-bar d-flex justify-content-between align-items-center">
            <div>
                <h1>College Football Rankings</h1>
                <h3>{{ year }} Season - Week {{ week }}</h3>
            </div>
            <a href="/" class="btn btn-primary"><i class="fas fa-arrow-left"></i> Back to Home</a>
        </div>

        <div class="row mb-4">
            <div class="col">
                <div class="search-box">
                    <input type="text" class="form-control" id="teamSearch" placeholder="Search for a team...">
                </div>
            </div>
        </div>

        <!-- Team Rankings Table -->
        <h2>Team Rankings</h2>
        <div class="table-container">
            <table class="table table-striped table-responsive">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>Conference</th>
                        <th>Record</th>
                        <th>vs P4 <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Record against Power 4 teams"></i></th>
                        <th>vs G5 <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Record against Group of 5 teams"></i></th>
                        <th>vs FCS <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Record against FCS teams"></i></th>
                        <th>SoS <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Strength of Schedule (Avg Opponent Elo)"></i></th>
                        <th>SoV <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Strength of Victory (Avg Win Elo)"></i></th>
                        <th>Team Quality <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Base Quality Score (Q_A)"></i></th>
                        <th>Conf Quality <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Conference Quality Score (CQ_CA)"></i></th>
                        <th>Final Score <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Final Ranking Score (FRS_A)"></i></th>
                    </tr>
                </thead>
                <tbody>
                    {% for team in team_rankings %}
                    <tr class="{% if loop.index <= 25 %}top-25{% endif %}">
                        <td>{{ loop.index }}</td>
                        <td>{{ team.team_name }}</td>
                        <td>{{ team.conference }}</td>
                        <td>{{ team.records.total_wins }}-{{ team.records.total_losses }}</td>
                        <td>{{ team.records.power_wins }}-{{ team.records.power_losses }}</td>
                        <td>{{ team.records.group_five_wins }}-{{ team.records.group_five_losses }}</td>
                        <td>{{ team.records.fcs_wins }}-{{ team.records.fcs_losses }}</td>
                        <td>{{ "%.0f"|format(team.sos) }}</td>
                        <td>{{ "%.0f"|format(team.sov) }}</td>
                        <td>{{ "%.2f"|format(team.team_quality_score) }}</td>
                        <td>{{ "%.2f"|format(team.conference_quality_score) }}</td>
                        <td>{{ "%.2f"|format(team.final_ranking_score) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Conference Rankings Table -->
        <h2>Conference Rankings</h2>
        <div class="table-container">
            <table class="table table-striped table-responsive">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Conference</th>
                        <th>Teams</th>
                        <th>vs P4 <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Record against Power 4 conferences"></i></th>
                        <th>vs G5 <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Record against Group of 5 conferences"></i></th>
                        <th>vs FCS <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Record against FCS conferences"></i></th>
                        <th>Avg Team Quality <i class="fas fa-info-circle tooltip-info" data-bs-toggle="tooltip" title="Average Team Quality Score (CQ_C)"></i></th>
                    </tr>
                </thead>
                <tbody>
                    {% for conf in conference_rankings %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ conf.conference_name }}</td>
                        <td>{{ conf.number_of_teams }}</td>
                        <td>{{ conf.record_vs_p4 }}</td>
                        <td>{{ conf.record_vs_g5 }}</td>
                        <td>{{ conf.record_vs_fcs }}</td>
                        <td>{{ "%.2f"|format(conf.average_team_quality) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Ranking Algorithm Parameters (V3.8 - SoS Emphasis)</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li><strong>Team Quality (Elo) Weight:</strong> 60% (Base Strength)</li>
                    <li><strong>Record Score Weight:</strong> 30% (Resume & SoS)</li>
                    <li><strong>Conference Weight:</strong> 10% (Context)</li>
                    <li><strong>Strength of Schedule:</strong> High impact bonus for playing tough opponents (Win or Loss).</li>
                    <li><strong>Strength of Victory:</strong> Significant bonus for beating quality opponents (Avg Win Elo > 1200).</li>
                </ul>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">How it Works</h5>
            </div>
            <div class="card-body">
                <p><strong>Formula:</strong> FRS = (0.6 × TeamQuality) + (0.3 × RecordScore) + (0.1 × ConferenceQuality)</p>
                <p>This system prioritizes <strong>Resume (Record)</strong>. The Record Score now includes:</p>
                <ul>
                    <li><strong>Weighted Wins:</strong> Road wins count as 1.1 wins.</li>
                    <li><strong>Strength of Schedule (SoS):</strong> Bonus based on the average quality of <em>all</em> opponents played.</li>
                    <li><strong>Strength of Victory (SoV):</strong> Bonus based on the average quality of teams <em>defeated</em>.</li>
                </ul>
            </div>
        </div>
    </div>

    <a href="#" class="btn btn-primary scroll-btn" id="backToTop"><i class="fas fa-arrow-up"></i></a>

    <footer class="bg-light py-3 text-center mt-5">
        <div class="container">
            <p>&copy; 2023-2025 CFB Ranking System</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Team search functionality
        document.getElementById('teamSearch').addEventListener('keyup', function() {
            var searchText = this.value.toLowerCase();
            var teamRows = document.querySelectorAll('tbody tr');
            
            teamRows.forEach(function(row) {
                var teamName = row.cells[1].textContent.toLowerCase();
                var conferenceText = row.cells[2].textContent.toLowerCase();
                
                if (teamName.includes(searchText) || conferenceText.includes(searchText)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Back to top button
        window.onscroll = function() {
            if (document.body.scrollTop > 500 || document.documentElement.scrollTop > 500) {
                document.getElementById('backToTop').style.display = 'block';
            } else {
                document.getElementById('backToTop').style.display = 'none';
            }
        };

        document.getElementById('backToTop').addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({top: 0, behavior: 'smooth'});
        });

        // Hide back to top button initially
        document.getElementById('backToTop').style.display = 'none';
    </script>
</body>
</html>
